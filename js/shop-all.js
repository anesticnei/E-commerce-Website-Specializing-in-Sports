const shopAll = [
    {
        id: 0,
        category: "Women",
        category_title: "Women's",
        product_info_title: "Tank Bra Hei",
        product_info_descr: "Women's High-Impact Seamless Sports Bra",
        color: "Olive",
        colors_number: 6,
        price: 52.97,
        picture: "https://cdn.shopify.com/s/files/1/2156/4663/products/OliveTankBra-1_712x894.jpg?v=1663161987",
    },
    {
        id: 1,
        category: "Women",
        category_title: "Women's",
        product_info_title: "Tank Bra Ayn",
        product_info_descr: "Women's High-Impact Seamless Sports Bra",
        color: "Black",
        colors_number: 4,
        price: 38.97,
        picture: "https://cdn.shopify.com/s/files/1/2156/4663/products/Black-1-18_712x894.jpg?v=1619440922",
        // add_button: ,

    },
    {
        id: 2,
        category: "Women",
        category_title: "Women's",
        product_info_title: "Full crop Hei",
        product_info_descr: "Women's High-Impact Seamless Sports Bra",
        color: "Blue",
        colors_number: 4,
        price: 64.99,
        picture: "https://blog.prettylittlething.com/wp-content/uploads/2021/01/Weight-Training-700x1116.png",
        // add_button: ,

    },
    {
        id: 3,
        category: "Women",
        category_title: "Women's",
        product_info_title: "Full Crop Ayn",
        product_info_descr: "Women's High-Impact Seamless Sports Bra",
        color: "Light Blue",
        colors_number: 2,
        price: 39.99,
        picture: "https://media.missguided.com/i/missguided/B1503750_01?fmt=jpeg&fmt.jpeg.interlaced=true&$product-page__main--2x$",
        // add_button: ,

    },
    {
        id: 4,
        category: "Women",
        category_title: "Women's",
        product_info_title: "Tank Full Wear",
        product_info_descr: "Women's High-Impact Seamless Sports Bra",
        color: "Sea",
        colors_number: 2,
        price: 59.47,
        picture: "https://cdn.shopify.com/s/files/1/1325/6099/products/DSC06456copy_2048x2048.jpg?v=1664470866",
    },
    {
        id: 5,
        category: "Women",
        category_title: "Women's",
        product_info_title: "Aynthei Top Bra",
        product_info_descr: "Women's High-Impact Seamless Sports Bra",
        color: "Olive",
        colors_number: 4,
        price: 74.40,
        picture: "https://athleta.gap.com/webcontent/0027/392/793/cn27392793.jpg",
    },
    {
        id: 6,
        category: "Women",
        category_title: "Women's",
        product_info_title: "Glam Body",
        product_info_descr: "Women's High-Impact Seamless Sports Bra",
        color: "Light Green",
        colors_number: 3,
        price: 45.20,
        picture: "https://media.karousell.com/media/photos/products/2021/6/6/hm_sportswear_1622998989_9b8e1e37_progressive.jpg",
    },
    {
        id: 7,
        category: "Women",
        category_title: "Women's",
        product_info_title: "Full Body Anei",
        product_info_descr: "Women's High-Impact Seamless Sports Bra",
        color: "Purple",
        colors_number: 4,
        price: 67.50,
        picture: "https://cdn.shopify.com/s/files/1/2156/4663/products/ADANOLA_006_013_712x894.jpg?v=1669031612",
    },
    {
        id: 8,
        category: "Women",
        category_title: "Women's",
        product_info_title: "Full Body Aynt",
        product_info_descr: "Women's High-Impact Seamless Sports Bra",
        color: "Olive",
        colors_number: 3,
        price: 68.00,
        picture: "https://cdn.shopify.com/s/files/1/2156/4663/products/221216_ADANOLA_JANUARY_RR_S07_051copy_712x894.jpg?v=1673274846",
    },
    {
        id: 9,
        category: "Women",
        category_title: "Women's",
        product_info_title: "Thei Body",
        product_info_descr: "Women's High-Impact Seamless Sports Bra",
        color: "Light Blue",
        colors_number: 5,
        price: 64.98,
        picture: "https://cdn-img.prettylittlething.com/0/9/7/5/097505b370165adf88ce19614a794bd13bd46bbc_cms3431_1.jpg",
    },
    {
        id: 10,
        category: "Women",
        category_title: "Women's",
        product_info_title: "Ayn Body",
        product_info_descr: "Women's High-Impact Seamless Sports Bra",
        color: "White & Light Blue",
        colors_number: 3,
        price: 64.58,
        picture: "https://cdn-img.prettylittlething.com/f/0/0/4/f00402f771ed67b3bde54309252a97e93d89f5fd_cmm2612_1.jpg",
    },
    {
        id: 22,
        category: "Women",
        category_title: "Women's",
        product_info_title: "",
        product_info_descr: "",
        color: "",
        colors_number: "",
        price: "",
        picture: "",
    },
    {
        id: 11,
        category: "Men",
        category_title: "Men's",
        product_info_title: "Sport T-shirt",
        product_info_descr: "Men's High-Impact Sports T-Shirt",
        color: "Black",
        colors_number: 6,
        price: 52.97,
        picture: "https://cdn.shopify.com/s/files/1/2678/2664/products/dynamic-t-shirt-black-clothing-ryderwear-229014_1000x1000.jpg?v=1671074812",
    },
    {
        id: 12,
        category: "Men",
        category_title: "Men's",
        product_info_title: "Gym Active T-shirt",
        product_info_descr: "Men's High-Impact Sports T-Shirt",
        color: "Black",
        colors_number: 4,
        price: 64.57,
        picture: "https://cdn.shopify.com/s/files/1/0365/1893/products/mens-core-seamless-t-shirt-blackout_1024x.jpg?v=1667409403",
    },
    {
        id: 13,
        category: "Men",
        category_title: "Men's",
        product_info_title: "Casual T-shirt",
        product_info_descr: "Men's High-Impact Sports T-Shirt",
        color: "White",
        colors_number: 1,
        price: 49.09,
        picture: "https://cdn.shopify.com/s/files/1/0365/1893/products/mens-icon-t-shirt-white_1024x.jpg?v=1672395769",
    },
    {
        id: 14,
        category: "Men",
        category_title: "Men's",
        product_info_title: "Casual T-shirt",
        product_info_descr: "Men's High-Impact Sports T-Shirt",
        color: "Black",
        colors_number: 4,
        price: 49.09,
        picture: "https://publish.one37pm.net/wp-content/uploads/2022/12/Screen-Shot-2022-12-21-at-12.22.33-PM.png?fit=783%2C1145",
    },
    {
        id: 15,
        category: "Men",
        category_title: "Men's",
        product_info_title: "Gym Active T-shirt",
        product_info_descr: "Men's High-Impact Sports T-Shirt",
        color: "Black",
        colors_number: 3,
        price: 64.57,
        picture: "https://cdn.shopify.com/s/files/1/0365/1893/products/mens-icon-t-shirt-black_ba3306fc-9235-4618-a325-70782c362792_1024x.jpg?v=1672395765",
    },
    {
        id: 16,
        category: "Men",
        category_title: "Men's",
        product_info_title: "Casual T-shirt",
        product_info_descr: "Men's High-Impact Sports T-Shirt",
        color: "Orange",
        colors_number: 3,
        price: 69.00,
        picture: "https://cdn.shopify.com/s/files/1/2678/2664/products/dynamic-oversized-t-shirt-orange-sherbet-clothing-ryderwear-689944_1000x1000.jpg?v=1671075565",
    },
    {
        id: 17,
        category: "Men",
        category_title: "Men's",
        product_info_title: "Casual T-shirt",
        product_info_descr: "Men's High-Impact Sports T-Shirt",
        color: "Cream",
        colors_number: 3,
        price: 69.00,
        picture: "https://cdn.shopify.com/s/files/1/2678/2664/products/dynamic-oversized-t-shirt-stone-clothing-ryderwear-634645_1000x1000.jpg?v=1671075340",
    },
    {
        id: 18,
        category: "Men",
        category_title: "Men's",
        product_info_title: "Casual Long sleeve",
        product_info_descr: "Men's High-Impact Sports T-Shirt",
        color: "Grey",
        colors_number: 5,
        price: 78.27,
        picture: "https://cdn.shopify.com/s/files/1/2678/2664/products/dynamic-pullover-jumper-petrol-clothing-ryderwear-384839_1000x1000.jpg?v=1671075132",
    },
    {
        id: 19,
        category: "Men",
        category_title: "Men's",
        product_info_title: "Glamour T-shirt",
        product_info_descr: "Men's High-Impact Sports T-Shirt",
        color: "Grey",
        colors_number: 1,
        price: 44.44,
        picture: "https://cdn.shopify.com/s/files/1/0124/5528/0699/products/Tee_Charcoal_01_Priority_600x.jpg?v=1588808521",
    },
    {
        id: 20,
        category: "Men",
        category_title: "Men's",
        product_info_title: "Glamour T-shirt ",
        product_info_descr: "Men's High-Impact Sports T-Shirt",
        color: "White",
        colors_number: 3,
        price: 52.22,
        picture: "https://cdn.shopify.com/s/files/1/0365/1893/products/mens-icon-t-shirt-white_1024x.jpg?v=1672395769",
    },
    {
        id: 21,
        category: "Men",
        product_info_title: "Casual T-shirt",
        product_info_descr: "Men's High-Impact Sports T-Shirt",
        color: "Black",
        colors_number: 3,
        price: 69.00,
        picture: "https://cdn.shopify.com/s/files/1/2678/2664/products/dynamic-oversized-t-shirt-petrol-clothing-ryderwear-449910_1000x1000.jpg?v=1671075185",
    },
    {
        id: 23,
        category: "Men",
        product_info_title: "",
        product_info_descr: "",
        color: "",
        colors_number: "",
        price: "",
        picture: "",
    },
]

// console.log(shopAll);
// const currentProducts = shopAll;
// let women = shopWomen;

// const womenShopBtn = document.querySelector('#women-shop-btn');
// const menShopBtn = document.querySelector('#men-shop-btn');
const productWrapper = document.getElementById('product-swiper-wrapper');
const backgroundToggle = document.querySelector('#background-toggle');
const footContainer = document.querySelector('.foot');
const freeShipping = document.querySelector('.free-shipping');
const shoppingBox = document.querySelector('.shopping-container');

// const showAllProducts = shopAll.map((items)=>{
//     return `<div class="shoes-box swiper-slide item-product flex justify-start flex-shrink">
//     <div class="product-cart flex-column wh-full">
//     <a href="" class="product-link wh-full block"> </a>
//             <div class="top-container relative rounded-half box-shadow-big-rounded clipped aspect-ratio-3_4">
//                 <div class="product-images-container wh-full absolute-tl clipped">
//                     <div class="product-images-wrapper wh-full">
//                         <div class="product-image-slide absolute-tl wh-full transition-all duration-200 mouseable: block product-image-slide-0">
//                             <img class="wh-full" src="${items.picture}" alt=""></img>
//                         </div>  
//                     </div>
//                 </div>
                                
//                         <div class='add-to-cart-btn add-product-box absolute bottom-0 right-0 pad-1rem z-i-1 cursor-pointer'>
//                                     <button class = 'add-to-cart-btn add-product-button till-phone-p-04rem rounded-full border-none w-2rem h-2rem bg-dark cursor-pointer'><svg xmlns='http://www.w3.org/2000/svg' width='100%' height='100%' viewBox='0 0 31.5 31.5'><path id='Icon_awesome-plus' data-name='Icon awesome-plus' d='M29.25,14.625H19.125V4.5a2.25,2.25,0,0,0-2.25-2.25h-2.25a2.25,2.25,0,0,0-2.25,2.25V14.625H2.25A2.25,2.25,0,0,0,0,16.875v2.25a2.25,2.25,0,0,0,2.25,2.25H12.375V31.5a2.25,2.25,0,0,0,2.25,2.25h2.25a2.25,2.25,0,0,0,2.25-2.25V21.375H29.25a2.25,2.25,0,0,0,2.25-2.25v-2.25A2.25,2.25,0,0,0,29.25,14.625Z' transform='translate(0 -2.25)' fill='#fff'/></svg></button>
//                         </div>
//             </div>
//             <div class="bottom-container relative transition-all min-h-7_5rem z-i-10 margin-t-b">
//                 <div class="product-info wh-full">
//                         <div class="flex items-center flex-wrap color-text-dark font-w-600 text-1rem">${items.product_info_title}</div>
//                             <div class="flex items-center flex-wrap  text-0_7rem gap-1vw">
//                                 <span class="color-text-grey">${items.color}</span>
//                                 <span class="bg-grey rounded-full padding-inline-0_4 color-text-white">${items.colors_number} Colors</span>
//                             </div>
//                         <h2 class="flex items-center flex-wrap color-text-grey font-w-600 text-0_7rem"> $ ${items.price}</h2>
//                 </div>
//                 </div>
//     </div>
// </div>`        
// });

// productWrapper.innerHTML = showAllProducts;


let currentProducts = shopAll;
let categories = new Set();
const basket = (JSON.parse(localStorage.getItem('Basket'))) || [];
let addToBasketButtons;



  
const addToBasket = (e) =>{



    const selectedtId = parseInt(e.target.dataset.id);
    const key = currentProducts.findIndex((product) =>
        product.id === selectedtId);
    
    basket.push(currentProducts.at(key));
    
    const basketTotal = basket.reduce((sum, product) =>{
        return sum += product.price
    }, 0);
    
    const basketSpan = document.querySelector('#count');
    basketSpan.innerHTML = basket.length;
    // console.log(basketTotal);
    
    // const total = document.getElementById('total');
    // total.innerHTML = "$ " + `${basketTotal}`;
    
    localStorage.setItem('Basket', JSON.stringify(basket));
  }

  function delElement(a){
    basket.splice(a, 1);
    displaycart();

}
function displaycart(a){
    let j = 0;
    total = 0;
    document.getElementById('count').innerHTML = basket.length;
    if(basket.length==0){
        document.getElementById('cartItem').innerHTML = "Your cart is empty";
        document.getElementById('total');
        // basketLinks.style.display = "none";
        footContainer.style.display = "none";
        shoppingBox.style.maxHeight = "30vh"
        
        const basketTotal = basket.reduce((sum, product) =>{
            return sum += product.price
        }, 0);
        const total = document.getElementById('total');
        total.innerHTML = "$ " +  `${basketTotal}`;
        // const sideBar = document.getElementById('shopping-box');
        // sideBar.style.display = "none";
        localStorage.setItem('Basket', JSON.stringify(basket));
    }
    else {
        document.getElementById('cartItem').innerHTML = basket.map((items) =>{
            let {picture, product_info_title, price} = items;
            footContainer.style.display = "flex";
            shoppingBox.style.maxHeight = "80vh"
            // total = total + (price * quality);
            total = total + price;
            
            if(total >=150){
                // freeShipping.style.backgroundColor = "rgba(0, 255, 209, 1)"
                // freeShipping.style.backgroundColor = "rgb(25 25 25)"
                freeShipping.style.backgroundImage = "linear-gradient(140deg, rgba(0, 255, 209, 1) 0%, rgba(234, 4, 126, 1) 25%, rgba(250, 234, 72, 1) 56%, rgba(51, 47, 208, 1) 100%)";
                freeShipping.style.color = "#000";
                freeShipping.innerHTML = "Free Shipping"
            }else{
                freeShipping.style.backgroundColor = "#fff";
                freeShipping.style.backgroundImage = "none";
                freeShipping.style.color = "#000";
                freeShipping.innerHTML = "no free shipping"
            }

            localStorage.setItem('Basket', JSON.stringify(basket));
            document.getElementById('total').innerHTML = "$ " + total.toFixed(2);


            // let quantityElement = document.querySelector('.cart-quality-input')[0];
            // let quality = quantityElement.value;
            // updateCartTotal();
            return(
                `<div class = 'cart-item relative flex-column gap-1 rounded-half'>
                    <div class="product-wrapper-basket flex justify-between w-full">
                        <div class="cart-box flex-column w-full gap-1"> 
                            <h3 class="product-name text-1_2rem color-text-light-grey">${product_info_title}</h3> 
                            <span class="product-price text-1rem color-text-grey"> $ ${price}</span>
                        </div> 
                        <div class="product-img-box cart-img product-image-slide wh-full transition-all duration-200 mouseable: block product-image-slide-0">
                            <img class="product-cover-img wh-full rounded-half" src="${picture}"></img>
                        </div>   
                    </div>
                <div class = "basket-border w-full"></div>`
                +
                "<img src='/icons/trash_grey.svg' alt='' class='trash-button-basket color-text-white' onclick = 'delElement("+(j++)+")'></img></div>"
                
            )
            
        }).join('');

        }
    }

const renderProducts = (items) =>{
    productWrapper.innerHTML = "";
    for(let i = 0; i < items.length; i++){
        const newProduct = document.createElement('div');
        newProduct.className = 'shoes-box swiper-slide item-product flex justify-start flex-shrink';
        newProduct.innerHTML = `<div class="product-cart flex-column wh-full">
        <a href="" class="product-link wh-full block"> </a>
                <div class="top-container relative rounded-half box-shadow-big-rounded clipped aspect-ratio-3_4">
                    <div class="product-images-container wh-full absolute-tl clipped">
                        <div class="product-images-wrapper wh-full">
                            <div class="product-image-slide absolute-tl wh-full transition-all duration-200 mouseable: block product-image-slide-0">
                                <img class="wh-full" src="${items[i].picture}" alt="Picture">
                            </div>  
                        </div>
                    </div>
                                    
                            
            <button data-id="${items[i].id}" class = 'add-to-cart-btn add-product-button till-phone-p-04rem rounded-full border-none w-2rem h-2rem bg-dark add-product-box absolute bottom-0 right-0 pad-1rem z-i-10 cursor-pointer margin_1rem'>
            <img src='/icons/plusX.svg' alt='Add to basket' class="wh-full event-pointer"></img>
            </button>
                            
                </div>
                <div class="bottom-container relative transition-all z-i-10 margin-t-b">
                    <div class="product-info wh-full">
                            <div class="flex items-center flex-wrap color-text-dark font-w-600 text-1rem">${items[i].product_info_title}</div>
                                <div class="flex items-center flex-wrap  text-0_7rem gap-0_4rem w-full">
                                    <span class="color-text-grey">${items[i].color}</span>
                                    <span class="bg-grey rounded-full padding-inline-0_4 color-text-white">${items[i].colors_number} Colors</span>
                                </div>
                            <h2 class="flex items-center flex-wrap color-text-grey font-w-600 text-0_7rem w-full"> $ ${items[i].price}</h2>
                    </div>
                    </div>
        </div>
        `
        productWrapper.appendChild(newProduct)
    }
    addToBasketButtons = document.querySelectorAll('.add-to-cart-btn');
    addToBasketButtons.forEach((btn) => btn.addEventListener("click",addToBasket))
    displaycart();
    let darkMode = localStorage.getItem('darkMode');
    if (darkMode == 'enabled'){
        let textColor = document.querySelectorAll('.color-text-dark');
        for(let txtClr of textColor){
            // txtClr.classList.add('changecolor');
            txtClr.style.color = "#F4F4F4"
        }
    }else{
        let textColor = document.querySelectorAll('.color-text-dark');
        for(let txtClr of textColor){
            // txtClr.classList.remove('changecolor');
            txtClr.style.color = "#1A1A1A"
        }
    }

};





const renderCategories = (items) => {
    for(let i = 0; i < items.length; i++){
        categories.add(items[i].category);
    }
    const categoriesItems = document.querySelector('.buttons-toggle');

    categories = [...categories]

    categories.forEach((category, index) =>{
        const newCategory = document.createElement('button');
        newCategory.classList = 'button-toggle border-none cursor-pointer z-i-10 font-w-600 color-text-bg';
        newCategory.innerHTML = category;
        newCategory.dataset.category = category;

        index === 0 ? newCategory.classList.add('active') : "";

        categoriesItems.appendChild(newCategory)
    })
    let darkMode = localStorage.getItem('darkMode');
    if (darkMode == 'enabled'){
        let textColor = document.querySelectorAll('.color-text-dark');
        for(let txtClr of textColor){
            // txtClr.classList.add('changecolor');
            txtClr.style.color = "#F4F4F4"
        }
    }else{
        let textColor = document.querySelectorAll('.color-text-dark');
        for(let txtClr of textColor){
            // txtClr.classList.remove('changecolor');
            txtClr.style.color = "#1A1A1A"
        }
    }

}


document.onload = renderProducts(currentProducts.filter((product) => product.category === "Women"))
document.onload = renderCategories(currentProducts)

const categoriesButton = document.querySelectorAll('.button-toggle');

categoriesButton.forEach((btn) =>{
    btn.addEventListener("click", (e) =>{
        const category = e.target.dataset.category;

        categoriesButton.forEach(btn => btn.classList.remove("active"));
        e.target.classList.add("active");

        currentProducts = shopAll;

        if(category === "Women"){
            currentProducts = currentProducts.filter((product) => product.category === "Women");
                backgroundToggle.style.width = "85px";
                backgroundToggle.style.transform = "translate(0px, 0px)";
                productWrapper.style.transform = "translate3d(0px, 0px, 0px)";
                // addToBasket(currentProducts);
        }else{
            currentProducts = currentProducts.filter((product) => product.category === category);
                backgroundToggle.style.width = "62px";
                backgroundToggle.style.transform = "translate(86px, 0px)";
                productWrapper.style.transform = "translate3d(0px, 0px, 0px)";
                // addToBasket(currentProducts);
        }


        // const selectedCategory = shopAll.filter((product) => product.category === category)
        // });
        renderProducts(currentProducts);
        
    })
    
})


const searchBarInput = document.getElementById('search-input');

searchBarInput.addEventListener("input", (e)=>{
    const search = (e.target.value);

    const foundProducts = currentProducts.filter((product) =>{
        if(product.product_info_title.toLowerCase().includes(search.toLowerCase())){
            return product
        }
    })

    const emptyState = document.querySelectorAll('.empty-state');

    // foundProducts.length === 0
    //   ? emptyState.style.display = "block"
    //   : emptyState.style.display = "none";

  
    renderProducts(foundProducts);
  });













  const shopIconBtn = document.querySelector('#shop-item-btn')

  shopIconBtn.addEventListener("click", ()=>{
    // console.log("siemka");
    const basketBox = document.getElementById('shopping-box');
    const visability = basketBox.getAttribute('data-visible')
    if(visability === 'false'){
        basketBox.setAttribute('data-visible', true);
        shopIconBtn.setAttribute('aria-expanded', true);
        basketBox.style.display = "block";
        navBackDrop.classList.add('h-full');
        document.body.style.overflow = "hidden";
        displaycart();

        navBackDrop.addEventListener("click", (e) => {
            if(e.target.classList.contains('nav-backdrop')){
                // console.log("Siemka");
                navBackDrop.classList.remove('h-full');
                basketBox.setAttribute('data-visible', false);
                shopIconBtn.setAttribute('aria-expanded', false);
                basketBox.style.display = "none";

                document.body.style.overflow = "scroll";
                // dropNaviItem.classList.remove('drop-navi-items-open');
            }
        } )

        
    }
    // else{
    //     basketBox.setAttribute('data-visible', false);
    //     shopIconBtn.setAttribute('aria-expanded', false);
    //     basketBox.style.display = "none";
    // }

  })


//   let shopingBasket = localStorage.getItem('Basket')

// if(basketTotal==0){
//     localStorage.setItem('Basket', 'null');
//     // addToBasket(e);
//     // displaycart()
// }else{
//     localStorage.setItem('Basket', 'enabled');
//     displaycart()
//     // addToBasket(e);
// }



// const shopBasket = JSON.parce(localStorage.getItem('Basket') || "[]");

// if(basket.length==0){
//     localStorage.setItem('Basket', 'null');
// }else{
//     localStorage.setItem('Basket', 'enabled');
// }




// localStorage.setItem('Basket', 'null')